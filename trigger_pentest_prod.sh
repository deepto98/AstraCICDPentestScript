URL=https://api.getastra.com/webhooks/integrations/ci-cd
ASTRA_ACCESS_TOKEN=CYzz2kfBt2DB1OAIIRIa5YdN7fOuaN7rPM8Xd6Dd5nI
ASTRA_PROJECT_ID=0585b026-5be3-4f89-a9fa-1f529226b5dc
ASTRA_AUDIT_MODE=automated
status_code=$(curl -s -o response.txt -w "%{http_code}" --user-agent "Chrome/79" --header "Content-Type: application/json" --request POST --data-raw "{\"accessToken\":\"$ASTRA_ACCESS_TOKEN\",\"projectId\":\"$ASTRA_PROJECT_ID\", \"mode\":\"$ASTRA_AUDIT_MODE\"}" $URL)
if [[ "$status_code" == "200" ]] ; then
  echo "✅ Astra pentest was successfully started."
  cat response.txt
else
  echo $status_code
  cat response.txt
  echo "⛔ Failed to start pentest."
  exit 1
fi
